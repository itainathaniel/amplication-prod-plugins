"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = exports.getOptions = void 0;
const tslib_1 = require("tslib");
const recast = tslib_1.__importStar(require("recast"));
const recastBabelParser = tslib_1.__importStar(require("recast/parsers/babel"));
const _babel_options_1 = tslib_1.__importDefault(require("recast/parsers/_babel_options"));
const ParseError_1 = require("./errors/ParseError");
function getOptions(options) {
    const babelOptions = (0, _babel_options_1.default)(options);
    babelOptions.plugins.push("typescript", "jsx");
    return babelOptions;
}
exports.getOptions = getOptions;
/**
 * Wraps recast.parse()
 * Sets parser to use the TypeScript parser
 */
function parse(source, options) {
    try {
        return recast.parse(source, {
            ...{
                parser: {
                    getOptions,
                    parse: (source, options) => {
                        return recastBabelParser.parser.parse(source, getOptions(options));
                    },
                },
            },
            ...options,
        });
    }
    catch (error) {
        if (error instanceof SyntaxError) {
            throw new ParseError_1.ParseError(error.message, source);
        }
        throw error;
    }
}
exports.parse = parse;
//# sourceMappingURL=main.js.map