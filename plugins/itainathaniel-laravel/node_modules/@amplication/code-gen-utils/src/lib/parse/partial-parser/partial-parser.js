"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.partialParse = void 0;
const tslib_1 = require("tslib");
const recast_1 = require("recast");
const recastBabelParser = tslib_1.__importStar(require("recast/parsers/babel"));
const ParseError_1 = require("../errors/ParseError");
const main_1 = require("../main");
function getOptions(options) {
    const parserOptions = (0, main_1.getOptions)(options);
    parserOptions.allowAwaitOutsideFunction = true;
    parserOptions.allowReturnOutsideFunction = true;
    parserOptions.allowSuperOutsideMethod = true;
    parserOptions.allowUndeclaredExports = true;
    return parserOptions;
}
/**
 * Wraps recast.parse()
 * Sets parser to use the TypeScript parser with looser restrictions
 */
function partialParse(source, options) {
    try {
        return (0, recast_1.parse)(source, {
            ...options,
            tolerant: true,
            parser: {
                parse: (source, options) => {
                    return recastBabelParser.parser.parse(source, getOptions(options));
                },
                getOptions,
            },
        });
    }
    catch (error) {
        if (error instanceof SyntaxError) {
            throw new ParseError_1.ParseError(error.message, source);
        }
        throw error;
    }
}
exports.partialParse = partialParse;
//# sourceMappingURL=partial-parser.js.map